<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aarohi's Geometry & Robotics Lab</title>
    <style>
        :root {
            --bg-color: #f0fdfa; /* Minty freshness for geometry */
            --sidebar-bg: #ffffff;
            --card-bg: #ffffff;
            --accent-color: #0d9488;
            --text-main: #134e4a;
            --logic-color: #ea580c; /* Orange for the 'Think' bridge */
            --ans-color: #15803d;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        #sidebar {
            width: 320px;
            background-color: var(--sidebar-bg);
            padding: 1.5rem;
            box-shadow: 4px 0 15px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            gap: 1rem;
            z-index: 10;
            overflow-y: auto;
        }

        h2 { color: var(--accent-color); margin: 0; font-size: 1.4rem; }
        
        .section {
            background: #f1f5f9;
            padding: 12px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .label-title { font-weight: bold; font-size: 0.8rem; text-transform: uppercase; color: #64748b; }

        select, input { padding: 8px; border-radius: 8px; border: 1px solid #cbd5e1; }

        button {
            padding: 1rem;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }

        button:hover { filter: brightness(1.1); }

        #main-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        #card {
            background: var(--card-bg);
            width: 90%;
            max-width: 850px;
            height: 600px;
            border-radius: 40px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            border: 10px solid white;
            padding: 30px;
            text-align: center;
            overflow: hidden;
        }

        #canvas-container {
            width: 100%;
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        svg { background: #fafafa; border-radius: 20px; border: 1px solid #e2e8f0; }
        .grid-line { stroke: #e5e7eb; stroke-width: 1; }

        #problem-text { font-size: 1.8rem; font-weight: 700; margin: 10px 0; }
        
        #logic-bridge { 
            font-size: 1.4rem; 
            color: var(--logic-color); 
            font-weight: 600; 
            background: #fff7ed;
            padding: 12px 25px;
            border-radius: 20px;
            visibility: hidden;
        }

        #answer {
            font-size: 2.2rem;
            color: var(--ans-color);
            font-weight: 800;
            visibility: hidden;
        }

        .visible { visibility: visible !important; }
        kbd { background: #333; color: white; padding: 2px 6px; border-radius: 4px; }
    </style>
</head>
<body>

    <div id="sidebar">
        <h2>Geometry Lab</h2>
        
        <div class="section">
            <span class="label-title">Experiment Mode</span>
            <select id="modeSelect" onchange="newChallenge()">
                <option value="angles">Robotics Compass (Angles)</option>
                <option value="shapes">Designer's Shapes (Area/Peri)</option>
                <option value="paradox">Perimeter-Area Paradox</option>
            </select>
        </div>

        <div class="section">
            <span class="label-title">Shapes Enabled</span>
            <label><input type="checkbox" class="shape-check" value="square" checked> Square</label>
            <label><input type="checkbox" class="shape-check" value="rectangle" checked> Rectangle</label>
            <label><input type="checkbox" class="shape-check" value="equilateral" checked> Equilateral Triangle</label>
        </div>

        <div class="section">
            <span class="label-title">Visual Aids</span>
            <label><input type="checkbox" id="gridToggle" checked onchange="drawShape()"> Show 1x1 Unit Grid</label>
        </div>

        <button onclick="newChallenge()">New Challenge</button>
        
        <div style="margin-top: auto; font-size: 0.8rem; color: #64748b;">
            Press <kbd>â†“</kbd> to step through.<br>
            Aarohi: Watch how the grid helps you count the "insides"!
        </div>
    </div>

    <div id="main-area">
        <div id="card">
            <div id="canvas-container">
                <svg id="svg" width="400" height="300" viewBox="0 0 400 300"></svg>
            </div>
            <div id="problem-text">Loading...</div>
            <div id="logic-bridge">Think: ...</div>
            <div id="answer">...</div>
        </div>
    </div>

    <script>
        let step = 0;
        let currentProblem = {};

        function drawGrid() {
            const svg = document.getElementById('svg');
            svg.innerHTML = '';
            if (!document.getElementById('gridToggle').checked) return;
            
            for (let x = 0; x <= 400; x += 20) {
                let line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", x); line.setAttribute("y1", 0);
                line.setAttribute("x2", x); line.setAttribute("y2", 300);
                line.setAttribute("class", "grid-line");
                svg.appendChild(line);
            }
            for (let y = 0; y <= 300; y += 20) {
                let line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", 0); line.setAttribute("y1", y);
                line.setAttribute("x2", 400); line.setAttribute("y2", y);
                line.setAttribute("class", "grid-line");
                svg.appendChild(line);
            }
        }

        function drawShape() {
            drawGrid();
            const svg = document.getElementById('svg');
            const mode = document.getElementById('modeSelect').value;
            const p = currentProblem;

            if (mode === 'angles') {
                const cx = 200, cy = 250;
                const len = 120;
                const rad = (p.angle * Math.PI) / 180;
                const x2 = cx + len * Math.cos(-rad);
                const y2 = cy + len * Math.sin(-rad);

                // Base line
                let base = document.createElementNS("http://www.w3.org/2000/svg", "line");
                base.setAttribute("x1", cx); base.setAttribute("y1", cy);
                base.setAttribute("x2", cx + len); base.setAttribute("y2", cy);
                base.setAttribute("stroke", "#94a3b8"); base.setAttribute("stroke-width", "4");
                svg.appendChild(base);

                // Moving arm
                let arm = document.createElementNS("http://www.w3.org/2000/svg", "line");
                arm.setAttribute("x1", cx); arm.setAttribute("y1", cy);
                arm.setAttribute("x2", x2); arm.setAttribute("y2", y2);
                arm.setAttribute("stroke", varProp('--accent-color')); arm.setAttribute("stroke-width", "6");
                svg.appendChild(arm);
            } else {
                // Rects, Squares, Triangles
                let shape = document.createElementNS("http://www.w3.org/2000/svg", p.type === 'equilateral' ? "polygon" : "rect");
                shape.setAttribute("fill", "rgba(13, 148, 136, 0.2)");
                shape.setAttribute("stroke", varProp('--accent-color'));
                shape.setAttribute("stroke-width", "3");

                if (p.type === 'equilateral') {
                    const s = p.side * 20;
                    const h = (Math.sqrt(3)/2) * s;
                    const points = `${200-s/2},${150+h/2} ${200+s/2},${150+h/2} ${200},${150-h/2}`;
                    shape.setAttribute("points", points);
                } else {
                    const w = p.w * 20;
                    const h = p.h * 20;
                    shape.setAttribute("x", 200 - w/2);
                    shape.setAttribute("y", 150 - h/2);
                    shape.setAttribute("width", w);
                    shape.setAttribute("height", h);
                }
                svg.appendChild(shape);
            }
        }

        function varProp(name) { return getComputedStyle(document.documentElement).getPropertyValue(name).trim(); }

        function newChallenge() {
            step = 0;
            document.getElementById('logic-bridge').classList.remove('visible');
            document.getElementById('answer').classList.remove('visible');
            
            const mode = document.getElementById('modeSelect').value;
            const probEl = document.getElementById('problem-text');
            const logicEl = document.getElementById('logic-bridge');
            const ansEl = document.getElementById('answer');

            if (mode === 'angles') {
                const angle = [30, 45, 60, 90, 120, 135, 180, 210, 270][Math.floor(Math.random()*9)];
                currentProblem = { angle: angle };
                probEl.innerText = "What type of angle is this?";
                let type = "Acute";
                if(angle === 90) type = "Right";
                else if(angle > 90 && angle < 180) type = "Obtuse";
                else if(angle === 180) type = "Straight";
                else if(angle > 180) type = "Reflex";

                logicEl.innerText = `Think: Compare it to 90Â° (Corner) or 180Â° (Line)`;
                ansEl.innerText = `${type} (${angle}Â°)`;
            } 
            else if (mode === 'shapes') {
                const shapes = Array.from(document.querySelectorAll('.shape-check:checked')).map(c => c.value);
                const type = shapes[Math.floor(Math.random()*shapes.length)];
                const isArea = Math.random() > 0.5;

                if (type === 'equilateral') {
                    const side = Math.floor(Math.random()*6)+4;
                    currentProblem = { type, side };
                    probEl.innerText = `Equilateral Triangle: Side = ${side}cm. Perimeter?`;
                    logicEl.innerText = `Think: 3 sides of equal length. ${side} + ${side} + ${side}`;
                    ansEl.innerText = `${side * 3} cm`;
                } else {
                    const w = Math.floor(Math.random()*8)+3;
                    const h = (type === 'square') ? w : Math.floor(Math.random()*6)+2;
                    currentProblem = { type, w, h };
                    if (isArea) {
                        probEl.innerText = `${type}: ${w}cm x ${h}cm. Find the Area.`;
                        logicEl.innerText = `Think: Count the grid squares inside. ${w} Ã— ${h}`;
                        ansEl.innerText = `${w * h} cmÂ²`;
                    } else {
                        probEl.innerText = `${type}: ${w}cm x ${h}cm. Find Perimeter.`;
                        logicEl.innerText = `Think: Sum of all 4 sides. (${w} + ${h}) Ã— 2`;
                        ansEl.innerText = `${(w + h) * 2} cm`;
                    }
                }
            }
            else if (mode === 'paradox') {
                const area = 24;
                const pairs = [[6,4], [8,3], [12,2]];
                const pair = pairs[Math.floor(Math.random()*3)];
                currentProblem = { type: 'rectangle', w: pair[0], h: pair[1] };
                probEl.innerText = `Paradox: This rectangle has an Area of 24cmÂ². What is its Perimeter?`;
                logicEl.innerText = `Think: Sides are ${pair[0]} and ${pair[1]}. Perimeter = 2 Ã— (L + W)`;
                ansEl.innerText = `${(pair[0] + pair[1])*2} cm (Other 24cmÂ² shapes have different perimeters!)`;
            }
            drawShape();
        }

        function handleStep() {
            if (step === 0) { document.getElementById('logic-bridge').classList.add('visible'); step = 1; }
            else if (step === 1) { document.getElementById('answer').classList.add('visible'); step = 2; }
            else { newChallenge(); }
        }

        window.addEventListener('keydown', (e) => {
            if (e.key === "ArrowDown") { e.preventDefault(); handleStep(); }
        });

        newChallenge();
		
		/** * AAROHI MATH SUITE POWER-UP v3 (Final)
		 * Features: Clean History (1 row/Q), Dynamic Sidebar Count, Tablet Button
		 */

		(function() {
			const sidebar = document.getElementById('sidebar');
			const card = document.getElementById('card');

			// 1. Setup UI Elements
			const counterDiv = document.createElement('div');
			counterDiv.id = 'q-counter-display';
			counterDiv.style = "font-size: 1.2rem; font-weight: bold; color: #888; margin-bottom: 10px; font-family: sans-serif;";
			counterDiv.innerText = "Question: #1";
			card.prepend(counterDiv);

			const historyLink = document.createElement('a');
			historyLink.id = 'history-link-main';
			historyLink.style = "margin-top: auto; font-size: 0.85rem; color: var(--accent-color); text-decoration: underline; cursor: pointer; display: block; padding-top: 20px;";
			historyLink.innerText = "ðŸ“œ View Session History (0)";
			sidebar.appendChild(historyLink);

			const nextBtn = document.createElement('button');
			nextBtn.style = "position: fixed; bottom: 30px; right: 30px; padding: 15px 40px; font-size: 1.2rem; background: var(--accent-color); color: white; border: none; border-radius: 50px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); cursor: pointer; z-index: 1000;";
			nextBtn.innerText = "Next Step âž”";
			document.body.appendChild(nextBtn);

			// 2. Logic & History Tracking
			let qCount = 1;
			let sessionHistory = [];
			let currentProblemCache = "";

			window.masterStep = function() {
				const probEl = document.getElementById('problem') || document.getElementById('problem-text');
				const ansEl = document.getElementById('answer');
				
				// State check using visibility
				const isAnswerHidden = (window.getComputedStyle(ansEl).visibility === 'hidden' || !ansEl.classList.contains('visible'));

				if (isAnswerHidden) {
					// STEP 1: Reveal Answer
					currentProblemCache = probEl.innerText; // Capture question text
					if (typeof handleStep === 'function') handleStep();
				} else {
					// STEP 2: Save current result before moving to next question
					sessionHistory.push({
						no: qCount,
						prob: currentProblemCache,
						ans: ansEl.innerText
					});
					
					// Update sidebar count immediately
					historyLink.innerText = `ðŸ“œ View Session History (${sessionHistory.length})`;

					// Move to next question
					if (typeof handleStep === 'function') handleStep();
					qCount++;
					counterDiv.innerText = `Question: #${qCount}`;
				}
			};

			// 3. Bindings & Events
			window.addEventListener('keydown', (e) => {
				if (e.key === "ArrowDown") {
					e.preventDefault();
					window.masterStep();
				}
			}, true);

			nextBtn.addEventListener('click', (e) => {
				e.preventDefault();
				window.masterStep();
			});

			historyLink.addEventListener('click', (e) => {
				e.preventDefault();
				if (sessionHistory.length === 0) return alert("No questions completed yet!");
				
				let report = `--- Session History (Total: ${sessionHistory.length}) ---\n\n`;
				sessionHistory.forEach(item => {
					report += `Q${item.no}: ${item.prob} = ${item.ans}\n`;
				});
				alert(report);
			});
		})();

		(function() {
			// 1. Create the Toggle Button
			const toggleBtn = document.createElement('button');
			toggleBtn.id = 'menu-toggle';
			toggleBtn.innerHTML = 'â˜° Settings';
			document.body.prepend(toggleBtn);

			const sidebar = document.getElementById('sidebar');

			// 2. Toggle Sidebar Function
			toggleBtn.onclick = function(e) {
				e.stopPropagation();
				sidebar.classList.toggle('open');
				toggleBtn.innerHTML = sidebar.classList.contains('open') ? 'âœ• Close' : 'â˜° Settings';
			};

			// 3. Close sidebar if user taps the main area (outside)
			document.getElementById('main-area').onclick = function() {
				if (sidebar.classList.contains('open')) {
					sidebar.classList.remove('open');
					toggleBtn.innerHTML = 'â˜° Settings';
				}
			};
		})();

    </script>
	
	
</body>
</html>