<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aarohi's Estimation Station</title>
    <style>
        /* Existing Styles ... */
		#main-area { height: 100vh; width: 100vw; display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative; }
		#card { max-height: 85vh; max-width: 90vw; height: auto; min-height: 300px; padding: 20px; box-sizing: border-box; background: #ffffff; border-radius: 40px; box-shadow: 0 25px 50px rgba(0,0,0,0.1); border: 10px solid white; text-align: center; }
		#answer { margin-top: 10px; line-height: 1; }
		@media (max-width: 768px) {
			body { flex-direction: column; overflow: auto; }
			#sidebar { position: fixed; left: -100%; top: 0; bottom: 0; width: 80%; transition: 0.3s ease; z-index: 2000; box-shadow: 10px 0 30px rgba(0,0,0,0.2); }
			#sidebar.open { left: 0; }
			#main-area { width: 100vw; height: 100vh; padding: 10px; }
			#card { width: 95%; height: 70vh; margin-top: 50px; }
			#menu-toggle { display: block !important; position: fixed; top: 15px; left: 15px; z-index: 3000; background: var(--accent-color); color: white; border: none; padding: 10px 15px; border-radius: 8px; font-weight: bold; }
			#fs-toggle { top: 10px !important; right: 10px !important; padding: 8px 12px !important; font-size: 0.8rem !important; }
			#problem, #problem-text { font-size: 3rem !important; }
		}
		#menu-toggle { display: none; }
        :root { --bg-color: #f0fff4; --sidebar-bg: #ffffff; --card-bg: #ffffff; --accent-color: #2d6a4f; --text-main: #1b4332; --text-muted: #52b788; --logic-color: #ff8c00; --actual-color: #0077b6; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg-color); color: var(--text-main); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        #sidebar { width: 320px; background-color: var(--sidebar-bg); padding: 1.5rem; box-shadow: 4px 0 15px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 1rem; z-index: 10; overflow-y: auto; }
        h2 { color: var(--accent-color); margin: 0; font-size: 1.5rem; }
        .section { background: #f8f9fa; padding: 12px; border-radius: 12px; display: flex; flex-direction: column; gap: 8px; }
        .label-title { font-weight: bold; font-size: 0.85rem; text-transform: uppercase; color: #444; }
        label { font-size: 0.9rem; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        button { padding: 1rem; background-color: var(--accent-color); color: white; border: none; border-radius: 12px; font-weight: bold; font-size: 1rem; cursor: pointer; transition: 0.2s; }
        button:hover { filter: brightness(1.2); }
        #main-area { flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(135deg, #f0fff4 0%, #d7f9e9 100%); }
        #problem { font-size: 5.5rem; font-weight: 800; margin-bottom: 20px; }
        #think-step { font-size: 2.5rem; color: var(--logic-color); font-weight: 600; margin: 10px 0; visibility: hidden; background: #fff8f0; padding: 10px 30px; border-radius: 50px; }
        #results { display: flex; gap: 50px; margin-top: 20px; visibility: hidden; }
        .result-box { display: flex; flex-direction: column; align-items: center; }
        .result-label { font-size: 1rem; font-weight: bold; text-transform: uppercase; color: var(--text-muted); }
        .result-val { font-size: 3.5rem; font-weight: 800; }
        .estimated .result-val { color: var(--logic-color); }
        .actual .result-val { color: var(--actual-color); }
        .visible { visibility: visible !important; }
        .instructions { position: absolute; bottom: 30px; opacity: 0.6; font-weight: 600; }
        kbd { background: #333; color: white; padding: 2px 6px; border-radius: 4px; }
    </style>
</head>
<body>
    <div id="sidebar">
        <h2>Estimation Lab</h2>
        <div class="section">
            <span class="label-title">Number Types</span>
            <label><input type="checkbox" class="type-check" value="int" checked> Whole Numbers</label>
            <label><input type="checkbox" class="type-check" value="dec" checked> Decimals</label>
            <label><input type="checkbox" class="type-check" value="frac"> Fractions</label>
        </div>
        <div class="section">
            <span class="label-title">Complexity</span>
            <label><input type="radio" name="level" value="1" checked> Level 1</label>
            <label><input type="radio" name="level" value="2"> Level 2</label>
        </div>
        <div class="section">
            <span class="label-title">Operations</span>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                <label><input type="checkbox" class="op-check" value="+" checked> (+)</label>
                <label><input type="checkbox" class="op-check" value="-" checked> (-)</label>
                <label><input type="checkbox" class="op-check" value="*" checked> (Ã—)</label>
                <label><input type="checkbox" class="op-check" value="/"> (Ã·)</label>
            </div>
        </div>
        <button id="newChallengeBtn">New Challenge</button>
    </div>

    <div id="main-area">
        <div id="card">
            <div id="problem">--</div>
            <div id="think-step">--</div>
            <div id="results">
                <div class="result-box estimated"><span class="result-label">Est.</span><span class="result-val" id="est-val">--</span></div>
                <div class="result-box actual"><span class="result-label">Act.</span><span class="result-val" id="act-val">--</span></div>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 0; 
        function getFriendly(n, type) { n = parseFloat(n); if (type === 'int') { if (n < 20) return Math.round(n / 5) * 5; if (n < 100) return Math.round(n / 10) * 10; return Math.round(n / 100) * 100; } if (type === 'dec') return Math.round(n); if (type === 'frac') { if (n < 0.3) return 0; if (n < 0.7) return 0.5; return 1; } return n; }

        function newProblem() {
            currentStep = 0; document.getElementById('think-step').classList.remove('visible'); document.getElementById('results').classList.remove('visible');
            const types = Array.from(document.querySelectorAll('.type-check:checked')).map(c => c.value);
            const ops = Array.from(document.querySelectorAll('.op-check:checked')).map(c => c.value);
            const level = document.querySelector('input[name="level"]:checked').value;
            if (!types.length || !ops.length) return;
            const type = types[Math.floor(Math.random() * types.length)];
            const op = ops[Math.floor(Math.random() * ops.length)];
            let n1, n2, disp1, disp2;
            if (type === 'int') { const range = (level == "1") ? [10, 50] : [50, 500]; n1 = Math.floor(Math.random() * (range[1] - range[0])) + range[0]; n2 = Math.floor(Math.random() * (range[1] / 2 - 5)) + 5; if (Math.random() > 0.5) n1 = Math.round(n1 / 10) * 10 + (Math.random() > 0.5 ? 1 : -1); disp1 = n1; disp2 = n2; }
            else if (type === 'dec') { n1 = (Math.random() * 10 + 1).toFixed(2); n2 = (Math.random() * 5 + 1).toFixed(2); disp1 = n1; disp2 = n2; }
            else { const d1 = Math.floor(Math.random() * 8) + 2; const num1 = Math.floor(Math.random() * (d1 - 1)) + 1; const d2 = Math.floor(Math.random() * 8) + 2; const num2 = Math.floor(Math.random() * (d2 - 1)) + 1; n1 = num1 / d1; n2 = num2 / d2; disp1 = `${num1}/${d1}`; disp2 = `${num2}/${d2}`; }
            const f1 = getFriendly(n1, type); const f2 = getFriendly(n2, type);
            let actual, estimated; const opSym = { '+': '+', '-': 'âˆ’', '*': 'Ã—', '/': 'Ã·' }[op];
            if (op === '+') { actual = parseFloat(n1) + parseFloat(n2); estimated = f1 + f2; }
            if (op === '-') { actual = parseFloat(n1) - parseFloat(n2); estimated = f1 - f2; }
            if (op === '*') { actual = parseFloat(n1) * parseFloat(n2); estimated = f1 * f2; }
            if (op === '/') { actual = parseFloat(n1) / parseFloat(n2); estimated = f1 / f2; }
            document.getElementById('problem').innerText = `${disp1} ${opSym} ${disp2}`;
            document.getElementById('think-step').innerText = `Think: ${f1} ${opSym} ${f2}`;
            document.getElementById('est-val').innerText = (estimated % 1 === 0) ? estimated : estimated.toFixed(2);
            document.getElementById('act-val').innerText = (actual % 1 === 0) ? actual : actual.toFixed(2);
        }

        function handleStep() {
            if (currentStep === 0) { document.getElementById('think-step').classList.add('visible'); currentStep = 1; }
            else if (currentStep === 1) { document.getElementById('results').classList.add('visible'); currentStep = 2; }
            else { newProblem(); }
        }

        document.getElementById('newChallengeBtn').addEventListener('click', newProblem);
        newProblem();

		/** UNIVERSAL POWER-UP v3 (Rectified) **/
		(function() {
			const sidebar = document.getElementById('sidebar');
			const card = document.getElementById('card');
			const counterDiv = document.createElement('div');
			counterDiv.id = 'q-counter-display';
			counterDiv.style = "font-size: 1.2rem; font-weight: bold; color: #888; margin-bottom: 10px; font-family: sans-serif;";
			counterDiv.innerText = "Question: #1";
			card.prepend(counterDiv);
			const historyLink = document.createElement('a');
			historyLink.id = 'history-link-main';
			historyLink.style = "margin-top: auto; font-size: 0.85rem; color: var(--accent-color); text-decoration: underline; cursor: pointer; display: block; padding-top: 20px;";
			historyLink.innerText = "ðŸ“œ History (0)";
			sidebar.appendChild(historyLink);
			const nextBtn = document.createElement('button');
			nextBtn.style = "position: fixed; bottom: 30px; right: 30px; padding: 15px 40px; font-size: 1.2rem; background: var(--accent-color); color: white; border: none; border-radius: 50px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 1000;";
			nextBtn.innerText = "Next Step âž”";
			document.body.appendChild(nextBtn);

			let qCount = 1; let sessionHistory = []; let currentProblemCache = "";

			window.masterStep = function() {
				const probEl = document.getElementById('problem') || document.getElementById('problem-text');
				const ansEl = document.getElementById('results') || document.getElementById('answer'); // Dynamic Check
				const isAnswerHidden = ansEl ? (window.getComputedStyle(ansEl).visibility === 'hidden' || !ansEl.classList.contains('visible')) : true;
				if (isAnswerHidden) {
					currentProblemCache = probEl.innerText;
					handleStep();
				} else {
					sessionHistory.push({ no: qCount, prob: currentProblemCache, ans: document.getElementById('act-val').innerText });
					historyLink.innerText = `ðŸ“œ History (${sessionHistory.length})`;
					handleStep();
					qCount++; counterDiv.innerText = `Question: #${qCount}`;
				}
			};

			window.addEventListener('keydown', (e) => { if (e.key === "ArrowDown") { e.preventDefault(); window.masterStep(); } }, true);
			nextBtn.addEventListener('click', (e) => { e.preventDefault(); window.masterStep(); });
			historyLink.addEventListener('click', (e) => { e.preventDefault(); if (!sessionHistory.length) return; let r = ""; sessionHistory.forEach(i => r += `Q${i.no}: ${i.prob} = ${i.ans}\n`); alert(r); });
		})();

        (function() {
            const toggleBtn = document.createElement('button'); toggleBtn.id = 'menu-toggle'; toggleBtn.innerHTML = 'â˜° Settings'; document.body.prepend(toggleBtn);
            toggleBtn.onclick = function(e) { e.stopPropagation(); document.getElementById('sidebar').classList.toggle('open'); toggleBtn.innerHTML = document.getElementById('sidebar').classList.contains('open') ? 'âœ• Close' : 'â˜° Settings'; };
        })();

        /** * AAROHI MATH SUITE: IMMERSIVE FULL-SCREEN POWER-UP 
         * Fixes: Overflowing answers, zooming issues, and adds Full-Screen toggle.
         */
        (function() {
            // 1. Force the page to fit the viewport and disable accidental zooming
            const meta = document.createElement('meta');
            meta.name = "viewport";
            meta.content = "width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no";
            document.getElementsByTagName('head')[0].appendChild(meta);

            // 1. Navigation Icons
            const navIcons = document.createElement('div');
            navIcons.id = 'nav-icons';
            navIcons.style = "position: fixed; top: 15px; right: 170px; z-index: 4000; display: flex; gap: 10px;";
            
            const homeLink = document.createElement('a');
            homeLink.href = 'index.html';
            homeLink.style = "display: block; padding: 10px 15px; background: rgba(0,0,0,0.5); color: white; border: none; border-radius: 8px; font-size: 0.9rem; text-decoration: none; cursor: pointer;";
            homeLink.innerHTML = 'ðŸ  Home';
            homeLink.title = 'Home';
            
            const aboutLink = document.createElement('a');
            aboutLink.href = 'about.html';
            aboutLink.style = "display: block; padding: 10px 15px; background: rgba(0,0,0,0.5); color: white; border: none; border-radius: 8px; font-size: 0.9rem; text-decoration: none; cursor: pointer;";
            aboutLink.innerHTML = 'â„¹ï¸ About';
            aboutLink.title = 'About';
            
            navIcons.appendChild(homeLink);
            navIcons.appendChild(aboutLink);
            document.body.appendChild(navIcons);

            // 2. Create the Full Screen Toggle Button
            const fsBtn = document.createElement('button');
            fsBtn.id = 'fs-toggle';
            fsBtn.innerHTML = 'â›¶ Full Screen';
            fsBtn.style = "position: fixed; top: 15px; right: 15px; z-index: 4000; padding: 10px 15px; background: rgba(0,0,0,0.5); color: white; border: none; border-radius: 8px; font-size: 0.9rem; cursor: pointer;";
            document.body.appendChild(fsBtn);

            // 3. Full Screen Logic
            fsBtn.onclick = function() {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => {
                        alert(`Error attempting to enable full-screen mode: ${err.message}`);
                    });
                    fsBtn.innerHTML = 'âœ• Exit Full Screen';
                } else {
                    document.exitFullscreen();
                    fsBtn.innerHTML = 'â›¶ Full Screen';
                }
            };

            // 4. "Auto-Scale" Logic: Shrinks the card if it exceeds the screen height
            function adjustScale() {
                const card = document.getElementById('card');
                const main = document.getElementById('main-area');
                if (!card || !main) return;

                // Reset scale to calculate true size
                card.style.transform = 'scale(1)';
                
                const padding = 40; // Safety margin
                const availableHeight = window.innerHeight - padding;
                const cardHeight = card.offsetHeight;

                if (cardHeight > availableHeight) {
                    const scaleFactor = availableHeight / cardHeight;
                    card.style.transform = `scale(${scaleFactor})`;
                    card.style.transformOrigin = 'center center';
                }
            }

            // Run on load and whenever the screen orientation changes
            window.addEventListener('resize', adjustScale);
            window.addEventListener('orientationchange', adjustScale);
            setTimeout(adjustScale, 100); // Initial check
        })();
    </script>
</body>
</html>